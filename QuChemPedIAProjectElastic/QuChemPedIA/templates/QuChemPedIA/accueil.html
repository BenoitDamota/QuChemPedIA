{% load static %}

{# block used as header #}
{% block header %}
    <!DOCTYPE html>
    <html lang="fr">
    <head>
      <!-- Chargement du CSS, bootstrap4, javascript et jQuery-->
      {% load bootstrap4 %}
      {% bootstrap_css %}
      {% bootstrap_javascript jquery='full' %}
      {% bootstrap_messages %}

      <title>QuChemPedIA</title>
      <link rel="stylesheet" type="text/css" href="{% static "css/general.css" %}">
      <script src="{% static "js/dropzone.js" %}"></script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Nunito" />
    </head>
{% endblock %}
{% block nav %}
      <div  id="sign" class="row float-right">
                <!-- Bouton login-->
                  {% if not user.is_authenticated %}
                    <div id="sign" class="col col-perso" align=right>
                        <form method="get" action="{% url 'auth' %}">
                          <button id="button-login" type="submit" class="btn btn-info default-primary-color">
                            Sign In&nbsp;/&nbsp;Sign Up
                          </button>
                        </form>
                    </div>
                  {% else %}
                      <!-- Bouton Request calcul-->
                          <button id="button-calcul" class="btn btn-info default-primary-color" >
                            Calcul request
                          </button>
                      {%  if user.is_admin %}
                            <form method="POST" action="{% url 'admin' %}">
                             {% csrf_token %}
                              <button id="button-admin" type="submit" class="btn btn-info default-primary-color ">
                                admin
                              </button>
                            </form>
                    {% endif %}
                        <form method="POST" action="{% url 'dashboard' %}">
                            {% csrf_token %}
                          <button id="button-dashboard" type="submit" class="btn btn-info default-primary-color">
                            My profile
                          </button>
                        </form>
                    <form method="POST" action="{% url 'logout' %}">
                        {% csrf_token %}
                      <button type="submit" class="btn btn-info default-primary-color">
                        Sign out
                      </button>
                    </form>
                  {% endif %}
                </div>
{% endblock %}

{% block content %}
<div class="container" >
  <div class="Absolute-Center is-Responsive ">
    <h1 class="display-2 text-center text-primary">QuChemPedIA</h1>
    <h2 id="subtitle" class="diplay-2 text-center">Quantum Chemistry Collaborative EncyclopedIA</h2>
    <br/>
    <div id="form-accueil">
      <!-- Formulaire de recherche -->
      <form class="form-inline" action="{% url 'query' %}" method="GET" >
          {% csrf_token %}
          {{ query_form.as_table }}
          <button id="button-search" class="btn btn-info default-primary-color" type="submit">Search <i class="fa fa-search"></i></button>
      </form>
    </div>
    {% if user.is_authenticated %}
        {% if number_of_stand_by_import <= 20 %}
            <div id="div-dropzone">
              <!-- Génération de la dropzone -->
              <form id="myDropzone" action="{% url 'dashboard/import' %}" method="post" class="dropzone text-center">
                <div class="fallback">
                   <input type="hidden" name="csrfmiddlewaretoken" value="{% csrf_token %}" />
                  <input name="file" type="file"  />
                </div>
              </form>
            </div>
        {% else %}
            <div class="text-center text-info">
                <div class="col-lg-12">
                    <p>
                    <svg class="feather feather-info sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg"
                         width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                         stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" data-reactid="656">
                        <circle cx="12" cy="12" r="10"></circle>
                        <line x1="12" y1="16" x2="12" y2="12"></line>
                        <line x1="12" y1="8" x2="12" y2="8"></line>
                    </svg>
                       You have imported to much files in stand-by, wait until they have been processed
                    </p>
                </div>
            </div>
        {% endif %}
            {% if user.affiliation.strip|length <= 0 or user.affiliation == 'None' %}
                <div class="text-center text-danger">
                    <div class="col-lg-12">
                        <p>
                        <svg class="feather feather-alert-triangle sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg"
                             width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                             stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" data-reactid="56">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z">
                            </path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12" y2="17"></line>
                        </svg>
                            Warning! You are uploading a file but your affiliation is unknown.
                            This database entry won't be related to your laboratory!
                        </p>
                </div>
            </div>
            {% endif %}
            {% if user.number_of_upload_this_day >= 10  %}
                <div class="text-center text-info">
                    <div class="col-lg-12">
                        <p>
                            <svg class="feather feather-info sc-dnqmqq jxshSx" xmlns="http://www.w3.org/2000/svg"
                                 width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                 stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" data-reactid="656">
                                <circle cx="12" cy="12" r="10"></circle>
                                <line x1="12" y1="16" x2="12" y2="12"></line>
                                <line x1="12" y1="8" x2="12" y2="8"></line>
                            </svg>
                            If you want to import a large set of calculations results, you could contact us!
                            An <i>ad hoc</i> import script could be set. That will be quicker.
                        </p>
                    </div>
                </div>
            {% endif %}
            {% else %}
                <div class="form-row text-center">
                    <div class="col-lg-12 mt-4">
                        <form action="{% url 'dashboard/import' %}">
                            <button type="submit" class="btn btn-info default-primary-color">&nbsp;Upload my calculations anonymously&nbsp;</button>
                        </form>
                    </div>
                </div>
            {% endif %}
<footer>
  <!-- Génération de la navbar pour footer -->
  <nav class="navbar navbar-expand-sm fixed-bottom">
    <div class="footer">
      <a class="link-footer" href=""><u>Project</u></a>
      <a class="link-footer" href=""><u>Team</u></a>
      <a class="link-footer" href=""><u>Terms</u></a>
    </div>
  </nav>
</footer>
<script>
/* Script de rendu pour le formulaire de recherche */
 $(document).ready(function(){
      $("#id_search").attr("placeholder","Search...");
      $("#id_typeQuery").css("width","15%");
  });
</script>
    <script>

    Dropzone.autoDiscover = false;
   // using jQuery
        function getCookie(name) {
            var cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                var cookies = document.cookie.split(';');
                for (var i = 0; i < cookies.length; i++) {
                    var cookie = jQuery.trim(cookies[i]);
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        var csrftoken = getCookie('csrftoken');
       $("#myDropzone").dropzone({
        url:"{% url 'dashboard/import' %}",
        addRemoveLinks : true,
        maxFilesize: 5000,
        dictDefaultMessage: "Drop your log files here or click to upload",
        dictResponseError: 'Error uploading file!',
        headers: {
            'X-CSRFToken': csrftoken
        },
        success: function (file, response) {
            location.reload();
            this.removeFile(file); //todo discuter de quoi faire
        }
        });
    </script>

{% endblock %}
