{% extends "base.html" %}
{% block content %}
  {% if results|length >= 1 %}
  <div class="container">
    <h2 id="result-title"> Results </h2>
      {% for key, value in results.items %}
      <div id="list-query-group" class="list-group">
        <div class="card">
            <a href="http://127.0.0.1:8000/QuChemPedIA/details?id={{value.0.id_log}}" class="">
              <div class="card-header list-group-item list-group-item-action">
                {% if value.0.iupac != "Null" or value.0.iupac == 0 %}{{ value.0.iupac }}{% else %}N/A{% endif %}
              </div>
            </a>
          <div class="card-body">
            <div class="row">
              <div class="col-lg-3">
                <canvas id="{{ value.0.id_log }}">
                  Sorry, your browser doesn't support the &lt;canvas&gt; element.
                </canvas>
                {% if value.0.cansmiles %}
                  <script>
                    $(document).ready(function() {
                      var canvasH = $("#{{ value.0.id_log }}").height();
                      var canvasW = $("#{{ value.0.id_log }}").width();
                        let options = {width : canvasW,
                                       height : canvasH,
                        };

                        // Initialize the drawer
                        let smilesDrawer = new SmilesDrawer.Drawer(options);

                        SmilesDrawer.parse("{{ value.0.cansmiles }}", function(tree) {
                              // Draw to the canvas
                        smilesDrawer.draw(tree, '{{ value.0.id_log }}', 'light', false);
                        });
                    });
                  </script>
                {% endif %}
              </div>
              <div class="col-lg-9">
                <table class='table borderless table-condensed table-sm tableformat'>
                  <tbody>
                   <tr>
                     <td><strong>Inchi : </strong>{% if value.0.InChi != "Null" or value.0.InChi == 0 %}{{ value.0.InChi }}{% else %}N/A{% endif %}</td>
                     <td><strong>Software : </strong>{% if value.0.software != "Null" or value.0.software == 0 %}{{ value.0.software }}{% else %}N/A{% endif %}</td>
                     <td><strong>Basis set name : </strong>{% if value.0.basis_set_name != "Null" or value.0.basis_set_name == 0 %}{{ value.0.basis_set_name }}{% else %}N/A{% endif %}</td>
                     <td><strong>Solvatation method : </strong>{% if value.0.solvatation_method != "Null" or value.0.solvatation_method == 0 %}{{ value.0.solvatation_method }}{% else %}N/A{% endif %}</td>
                     <td><strong>Charge : </strong>{% if value.0.charge != "Null" or value.0.charge == 0 %}{{ value.0.charge }}{% else %}N/A{% endif %}</td>
                   </tr>
                   <tr>
                     <td><strong>Cansmiles : </strong>{% if value.0.cansmiles != "Null" or value.0.cansmiles == 0 %}{{ value.0.cansmiles }}{% else %}N/A{% endif %}</td>
                     <td><strong>Theory : </strong>{% if value.0.theory != "Null" or value.0.theory == 0 %}{{ value.0.theory }}{% else %}N/A{% endif %}</td>
                     <td><strong>Basis set size : </strong>{% if value.0.basis_set_size != "Null" or value.0.basis_set_size == 0 %}{{ value.0.basis_set_size }}{% else %}N/A{% endif %}</td>
                     <td><strong>Solvent : </strong>{% if value.0.solvent != "Null" or value.0.solvent == 0 %}{{ value.0.solvent }}{% else %}N/A{% endif %}</td>
                     <td><strong>Multiplicity : </strong>{% if value.0.multiplicity != "Null" or value.0.multiplicity == 0 %}{{ value.0.multiplicity }}{% else %}N/A{% endif %}</td>
                   </tr>
                   <tr>
                     <td><strong>Job type : </strong>{% if value.0.job_type != "Null" or value.0.job_type == 0 %}{{ value.0.job_type }}{% else %}N/A{% endif %}</td>
                     <td><strong>Functionnal : </strong>{% if value.0.functionnal != "Null" or value.0.functionnal == 0 %}{{ value.0.functionnal }}{% else %}N/A{% endif %}</td>
                     <td></td>
                     <td></td>
                     <td><strong>Ending energy : </strong>{% if value.0.ending_energy != "Null" or value.0.ending_energy == 0 %}{{ value.0.ending_energy }}{% else %}N/A{% endif %}</td>
                   </tr>
                 </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
      {% endfor %}
  </div>
      {% else %}
          <p>no result</p>
  {% endif %}
<div id="pagination">
  <i id="btn-previous" class="fa fa-angle-left" style="font-size:24px"></i>
  <span>Page : {{ page }}</span>
  <i id="btn-next" class="fa fa-angle-right" style="font-size:24px"></i>
</div>
<script>
  $(document).ready(function(){
    var nbresult = {{ results.nbresult }};
    console.log(({{ results.nbrresult }}).toString());
    console.log(nbresult);
    var result_per_page = {{ nbrpp }};
    console.log(result_per_page);
    var nbpages = Math.ceil(nbresult / result_per_page);
    console.log(nbpages);
    var url = window.location.href;
    console.log(window.location.href);
    var urlParams = new URLSearchParams(window.location.search);
    console.log(urlParams);
    var actualPage = urlParams.get('page');
    console.log(actualPage);
    console.log(urlParams.toString());
    if(actualPage == null){
      actualPage = 0;
    };
    console.log(actualPage);
    if ( actualPage < nbpages - 1){
      $('#btn-next').removeClass('fa-disabled');
      $("#btn-next").click(function(){
        actualPage++;
        console.log(actualPage);
        urlParams.set('page',actualPage);
        console.log(location.protocol + '//' + location.host + location.pathname);
        var newUrl = location.protocol + '//' + location.host + location.pathname + "?" + urlParams.toString();
        window.location.href = newUrl;
      });
    }else{
      $('#btn-next').addClass('fa-disabled');
    }
    if( actualPage > 0 ) {
      $('#btn-previous').removeClass('fa-disabled');
      $("#btn-previous").click(function(){
        actualPage--;
        console.log(actualPage);
        urlParams.set('page',actualPage);
        console.log(location.protocol + '//' + location.host + location.pathname);
        var newUrl = location.protocol + '//' + location.host + location.pathname + "?" + urlParams.toString();
        window.location.href = newUrl;
      });
    }else{
      $('#btn-previous').addClass('fa-disabled');
    }
  });

</script>
{% endblock %}
